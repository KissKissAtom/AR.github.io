<!DOCTYPE html>
<html>
<head>
  <title>AR VERS_28</title>
<!-- A-Frame itself -->
<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

<!-- Pure three.js code that the A-Frame components use for location-based AR -->
<script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/three.js/build/ar-threex-location-only.js'></script>

<!-- AR.js A-Frame components -->
<script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js'></script>
 
</head>
	
<body style="margin: 0; overflow: hidden;">

   <a-scene
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;"
    >

	<a-assets>
       		 <a-asset-items id="dragon" src="models/point3D2_clique.gltf" ></a-asset-items>
     	 </a-assets>
	   
	<a-assets>
       		 <a-asset-items id="panneau" src="models/panneau.gltf" ></a-asset-items>
     	 </a-assets>
  
<a-camera id='camera1' look-controls-enabled='false' arjs-device-orientation-controls='smoothingFactor: 0.1' gps-new-camera='gpsMinDistance: 5' far="1000" > </a-camera>

   <a-sphere cursor="fuse: false; rayOrigin: mouse"
          raycaster="objects: .poi"
	class="ar-point" color="blue" gps-new-entity-place="latitude: 45.776785; longitude: 3.085093"    radius="0.75" class="poi"></a-sphere>


	<a-entity
		cursor="fuse: false; rayOrigin: mouse"
          raycaster="objects: .poi"
        	gps-new-entity-place="latitude: 45.776273440409774; longitude: 3.0854013057225993;"
        	gltf-model="#dragon"
        	scale="3 3 3"
        	rotation="10 10 10"
        	position="0 -1 0"
        	look-at="[gps-camera]"
		class="poi"
      ></a-entity>
    	

	<a-entity
		cursor="fuse: false; rayOrigin: mouse"
          raycaster="objects: .poi"
        	gps-new-entity-place="latitude: 45.77682704985848; longitude: 3.0853824298336274;"
        	gltf-model="#dragon"
        	scale="3 3 3"
        	rotation="0 0 0"
        	position="0 -1 0"
        	look-at="[gps-camera]"
		class="poi"
      ></a-entity>

	<a-entity
		cursor="fuse: false; rayOrigin: mouse"
          raycaster="objects: .poi"
       		gps-new-entity-place="latitude: 45.77748672133725; longitude: 3.0854141756468056;"
        	gltf-model="#panneau"
        	scale="7 7 7"
        	rotation="0 90 0"
        	position="0 -1 0"
        	look-at="[gps-camera]"
		class="poi"
      ></a-entity>

	  <a-image 
    gps-new-entity-place="latitude: 45.776912; longitude: 3.0856243844092024;"
    src="models/pointIMG.png"
    width="10"
    height="10"
    look-at="[gps-camera]">
</a-image>

	  
  

  </a-scene>

<script>

document.querySelectorAll('.poi').forEach(el => {
  el.addEventListener('click', () => {
    alert("Vous avez cliqué sur un point d'intérêt !");
  });
});

	
	
/*const maxDistance = 10;

function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371000;
  const toRad = d => d * Math.PI / 180;
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a = Math.sin(dLat/2)**2 +
            Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
            Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

window.addEventListener('gps-camera-update-position', e => {
  const cam = e.detail.position;
  document.querySelectorAll('[gps-new-entity-place]').forEach(el => {
    const gps = el.getAttribute('gps-new-entity-place');
    const d = haversine(cam.latitude, cam.longitude,
                        parseFloat(gps.latitude),
                        parseFloat(gps.longitude));
    el.setAttribute('visible', d <= maxDistance);
  });
});*/
</script>

	

</body>
</html>
